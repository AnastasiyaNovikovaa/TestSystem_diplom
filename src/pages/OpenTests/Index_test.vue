<template>
  <div class="main-wrapper" >

    <DeleteMessage
      v-if="isPopupMessageVisible"
    />

    <Popup_close_test
      v-if="isPopupCloseVisible"
      @ClosePopup_close="ClosePopup_close"
    />
   
<a class="back_to_test" @click="$router.push({name: 'tests'})">
<p class="back_to_test_text"> Тесты </p></a>

   <!-- <div class="back_to_test">
       <p class="back_to_test_text"> Тесты </p>
    </div>-->

    
     <!-- <p class="head_test_full">{{need_test[0].name}} </p>-->
      <li v-for="index in need_test" :key="index.id">
      
      <div class="head_test">
      <div class="first_layer_head">
      <p class="back_to_test_text">Тест по теме</p>
      <button  @click="close_test" class="button button_close_test">Закрыть тест</button>
      </div>

      <p class="head_test_full">{{index.name}}</p>
       </div>

      <div class="block_info">
       <p class="Open_tests">Общая информация</p>
      <button class="DeleteTest" @click="DeleteTest"></button>

      <div class="block_info_1">
        <p> <b>Предмет: </b>{{index.subject}}</p>
        <p> <b>Категория: </b>{{index.category}}</p>
        <p v-if="index.createdDate!=null"> <b>Дата открытия: </b>{{index.createdDate}}</p>
        <p v-else> <b>Дата открытия: </b>21.03.2021 15:44</p>
        
        <p  v-if="index.deadline!=null"> <b>Дата закрытия: </b> {{index.deadline}}</p>
        <p v-else ><b>Дата закрытия:</b> Дедлайн не назначен</p>
        <p> <b>Полученных результатов:</b> 7 </p>
      </div>
    </div>

    <div class="block_info">
      <p class="Open_tests">Сводная статистика</p>
    <div class="block_info_2">
      <div class="grades">
        <p><b>Результаты тестирования:</b></p>
        <p class="grade1">Оценка "5" - 8 человек</p>
        <p class="grade2">Оценка "4" - 9 человек</p>
        <p class="grade3">Оценка "3" - 5 человек</p>
        <p class="grade4">Оценка "неуд" - 2 человек</p>
      </div>

      <div class="diagram">
        
      </div>
      
    </div>
  </div>

  <div class="table_grade">
      <div class="head_select">
       <p class="Open_tests">Таблица с результатами</p>
     
      <div class="Select select_test">
      <template>
         <b-form-select v-model="selected" class="mb-3 icon" >
        <b-form-select-option :value="null" class="text">Не выбрано</b-form-select-option>
        <b-form-select-option value="a" class="text">Сортировать А-Я</b-form-select-option>
        <b-form-select-option value="b" class="text">Сортировать Я-А</b-form-select-option>
        </b-form-select>
     </template>
    </div>

    <div>
        <b-form-input size="sm" class="mr-sm-2" placeholder="Поиск по ФИО" id="search_test"></b-form-input>
    </div>
   </div>

    <template>
  <div>
    <b-table id="my-table-2" striped hover :items="items" :fields="fields" :per-page="perPage"
      :current-page="currentPage" ></b-table>
  </div>
  </template>

  <div class="pagin">
   <b-pagination
      v-model="currentPage"
      :total-rows="rows"
      :per-page="perPage"
      aria-controls="my-table"

   ></b-pagination>

</div>

    </div>
      </li>
  

  </div>
</template>

<script>

import {mapActions, mapGetters} from 'vuex'
import axios from 'axios'
import DeleteMessage from '../../components/DeleteMessage.vue'
import Popup_close_test from '../../components/Popup_close_test.vue'

export default {
  name: '',
  components: {
    DeleteMessage,
    Popup_close_test
  },

  data() {
    return {
      isPopupMessageVisible: false,
      isPopupCloseVisible: false,
      id: this.$route.params['id'],
      selected: null,
        perPage: 10,
        currentPage: 1,
        fields: ['N','ФИО', 'Группа', 'P', 'Оценка', 'r', 'n', '1', '2','3','4','5','6','7','8','9'],
        items: [
          { isActive: true, N:'1.', ФИО: 'Андреев Андрей Андреевич', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', '1': '' },
          { isActive: true,  N:'2.', ФИО: 'Андреева Алена Григорьевна', Группа: '7301', P: '70',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true, N:'3.', ФИО: 'Богданов Петр Кадырович', Группа: '7301', P: '58',   Оценка: '3', r: '8', n: '4', 1: ''  },
          { isActive: true,  N:'4.', ФИО: 'Вишняков Сергей Алексеевич', Группа: '7301', P: '88',   Оценка: '5', r: '8', n: '4', 1: '' },
          { isActive: true, N:'5.', ФИО: 'Гордеева Анна Владимировна', Группа: '7301', P: '88', Оценка: '5', r: '8', n: '4', 1: '' },
          { isActive: true, N:'6.', ФИО: 'Дружинина Виктория Викторовна', Группа: '7301', P: '60',   Оценка: '3', r: '8', n: '4', 1: '' },
          { isActive: true, N:'7.', ФИО: 'Закиров Булат Исхакович', Группа: '7301', P: '65',   Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true, N:'8.',ФИО: 'Кудрявцев Игнат Семенович', Группа: '7301', P: '46',   Оценка: '3', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'9.',ФИО: 'Кошкин Александр Дмитриевич', Группа: '7301', P: '76',   Оценка: '5', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'10.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'11.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'12.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'13.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'14.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'15.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'16.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'17.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' },
          { isActive: true,  N:'18.', ФИО: 'Стручков Дмитрий Петрович', Группа: '7301', P: '65',  Оценка: '4', r: '8', n: '4', 1: '' }
        ],
    }
  },

  computed: {
    ...mapGetters([
      'TESTS'
      ]),
    rows() {
        return this.items.length
      },

      //доступ к данным конкретного теста
      need_test() {
    return this.TESTS.filter(test => test.id == this.id);
    },
  },

  methods: {
   
    ...mapActions([
        'GET_TEST_FROM_API'
      ]),

    DeleteTest(){
      //this.$store.commit('DeleteTest', this.id);
      axios.post('http://testing-system-ru.eu-west-2.elasticbeanstalk.com/api/v1/tests/' +this.id +'/delete', {
        headers: {
          "Accept": "application/json",
          "Access-Control-Allow-Origin": "*",
          "X-Requested-With": "XMLHttpRequest",
          "Access-Control-Allow-Methods" : "GET,POST,PUT,DELETE,OPTIONS",
          "Access-Control-Allow-Headers": "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With, append,delete,entries,foreach,get,has,keys,set,values,Authorization"
        }
      }),

      this.isPopupMessageVisible = true;
  },

  close_test(){
    console.log(this.need_test[0].evaluation);
   /*this.need_test[0].status='CLOSED';
   console.log(this.need_test[0].status);*/

    axios.put('http://testing-system-ru.eu-west-2.elasticbeanstalk.com/api/v1/tests/update/'+this.id, {

        status: 'CLOSED',
        name: this.need_test[0].name,
        description: this.need_test[0].description,
        category: this.need_test[0].category,
        createdDate: this.need_test[0].createdDate,
        deadline: this.need_test[0].deadline,
        subject: this.need_test[0].subject,
        questionResponseTime: this.need_test[0].questionResponseTime,
        headers: {
          "Accept": "application/json",
          "Access-Control-Allow-Origin": "*",
          "X-Requested-With": "XMLHttpRequest",
          "Access-Control-Allow-Methods" : "GET,POST,PUT,DELETE,OPTIONS",
          "Access-Control-Allow-Headers": "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With, append,delete,entries,foreach,get,has,keys,set,values,Authorization"
        }
      }),

    this.isPopupCloseVisible = true;

  },

  ClosePopup_close(){
      this.isPopupCloseVisible = false;
     },
},

mounted() {
    this.GET_TEST_FROM_API();
  }

}
</script>

<style>

  .button_close_test{
    float: right;
  }
  
  li{
    list-style-type: none;
  }

  button.DeleteTest{
    position: absolute;
    top: 34%;
    left: 34%;
    background-image: url("../../assets/grey_trash.svg");   
  height: 22px;
  width: 22px;
  background-size: 22px;
 background-repeat: no-repeat; 
  border: none;
  background-color: #F5F9FD;
  padding: 0px;
  margin-top: 4px;
  }


.back_to_test {
  position: absolute;
  top:20px;
  left: 260px;
  background-image: url("../../assets/arrow_back.png");   
  background-repeat: no-repeat;  
  background-position: 20px 8px;
  padding-left: 30px;
  background-position-x: left;
  cursor: pointer;
}

.back_to_test_text, .p_1 {
  font-family: 'RobotoMedium',  Helvetica, Arial, sans-serif;
  font-size: 16px;
  line-height: 150%;
  font-style: normal;
  font-weight: 600;
  color: #24252E;
  padding-top: 3px;
  float: left;
}

.head_test {
  margin-top: 30px;
}

.head_test_full{
  font-family: 'PoppinsBold',  Helvetica, Arial, sans-serif;
  font-size: 28px;
  text-align: left;
  font-style: normal;
  font-weight: 700;
  line-height: 42px;
  letter-spacing: 0em;
  margin-top: 16px;
  clear: both;
}

.block_info_1, .block_info_2{
  width: 510px;
  height: 236px;
  background: #FFFFFF;
  box-shadow: 0px 0px 18px rgba(128, 129, 145, 0.15);
  border-radius: 8px;
  padding: 28px 24px;
}

.block_info{
float:left;
margin-top: 24px;
margin-bottom: 60px;
}

.block_info_1{
   margin-right: 32px;
}

.p_1 {
  float: left;
  text-align:left;   
}

.grade1{
  background-image: url("../../assets/Rec1.png");   
  background-repeat: no-repeat;   
  padding-left: 20px;
  background-position: left; 
}

.grade2{
  background-image: url("../../assets/Rec2.png");   
  background-repeat: no-repeat;   
  padding-left: 20px;
  background-position: left; 
}
.grade3{
  background-image: url("../../assets/Rec3.png");   
  background-repeat: no-repeat;
  padding-left: 20px;
  background-position: left;    
}
.grade4{
  background-image: url("../../assets/Rec4.png");   
  background-repeat: no-repeat; 
  padding-left: 20px;
  background-position: left;   
}

.grades {
  float: left;
}

.diagram{
  background-image: url("../../assets/diagram.png");   
  background-repeat: no-repeat; 
  float: right;
  width: 200px;
  height: 200px;
  padding-top: 40px;
  margin-top: 20px;
}

.select_test {
 
}

.table_grade{
  padding-bottom: 60px;
}

.head_select{
  margin-bottom: 40px;
}

/*Таблица*/
#my-table-2 th,#my-table-2 td{
  padding-left: 0px;
}
#my-table-2 td:nth-child(1){
  background-image: none; 
      padding-left: 0px;
      width: 10px;
}

#my-table-2 td:nth-child(1){
  background-image: none;
  padding-right: 0px;
}


#my-table-2 thead th:nth-child(1){
 background-image: none;
      padding-left: 0px;

}
#my-table-2 thead th:nth-child(6){
  background-image: url("../../assets/correct.png");   
  background-size: 20px 20px;
  background-repeat: no-repeat;  
  background-position: 0px center; 
  }

#my-table-2 td:nth-child(2){
  width: 280px;
}

#my-table-2 td:nth-child(3){
  width: 110px;
}

#my-table-2 td:nth-child(4){
  width: 80px;
}

#my-table-2 td:nth-child(5){
  width: 90px;
}

#my-table-2 td:nth-child(6){
  width: 40px;
   background-image: none;
}

#my-table-2 td:nth-child(7){
  width: 40px;
  margin-right: 14px;
}

#my-table-2 thead th:nth-child(4){
color: #F5F9FD;
padding-left: 17px;
padding-right: 0px;
 background-image: url("../../assets/percent.svg"); 
 background-repeat: no-repeat;  
    background-position: 0px center; 
        background-size: 12px 12px;
}

#my-table-2 thead th:nth-child(6){
  color: #F5F9FD;
padding-left: 17px;
padding-right: 0px;
  background-image: url("../../assets/correct.svg");   
  background-size: 20px 20px;
    background-repeat: no-repeat;  
    background-position: 0px center; 
}

#my-table-2 thead th:nth-child(7){
  color: #F5F9FD;
  padding-left: 17px;
padding-right: 0px;
margin-right: 8px;
  background-image: url("../../assets/incorrect.svg");   
  background-size: 20px 20px;
    background-repeat: no-repeat;  
    background-position: 0px center; 
}

#my-table-2 td:nth-child(9), #my-table-2 td:nth-child(11), #my-table-2 td:nth-child(16) {
  background-image: url("../../assets/incorrect.svg");   
  background-size: 20px 20px;
    background-repeat: no-repeat;  
    background-position: 0px center; 
}

#my-table-2 td:nth-child(8), #my-table-2 td:nth-child(10),#my-table-2 td:nth-child(12), #my-table-2 td:nth-child(13), #my-table-2 td:nth-child(14), #my-table-2 td:nth-child(15) {
  background-image: url("../../assets/correct.svg");   
  background-size: 20px 20px;
    background-repeat: no-repeat;  
    background-position: 0px center; 
}

#my-table-2 thead th:nth-child(3){
 background-image: url("../../assets/arrows.png");
 background-repeat: no-repeat;  
    background-position: 50px center;

}

</style>
